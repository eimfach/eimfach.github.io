window.onload=function(){!function(){var e=new(window.AudioContext||window.webkitAudioContext),n=new XMLHttpRequest;function t(n){var t=e.createBufferSource();t.buffer=n,t.connect(e.destination),t.start()}n.open("GET","/audio/tonight-c-3.wav"),n.responseType="arraybuffer",n.onload=function(){e.decodeAudioData(n.response,t)},n.send()}();var e,n,t=function(e){return e.initializeApp({apiKey:"AIzaSyAG7ivSRnQUGb5xTuzztDM9YOzGY1IZKJc",authDomain:"blind-game-poll.firebaseapp.com",databaseURL:"https://blind-game-poll.firebaseio.com",projectId:"blind-game-poll",storageBucket:"blind-game-poll.appspot.com",messagingSenderId:"72922648857",appId:"1:72922648857:web:52ad5ce5e05b68bf4c3588"}),e.database().ref("/polls/0").once("value").then(function(e){return e.val()})}(window.firebase);e=t,n=document.getElementById("interactive-blind-poll"),e.then(function(e){n.innerHTML="";var t=e.items.map(function(e){return e.name}),a=document.createElement("input");a.type="text",a.id="pollKey",a.name="truhenschluessel-eingabe";var i=document.createElement("label");i.htmlFor="pollKey",i.appendChild(document.createTextNode("Truhenschluessel : "));var o=t.map(function(e){var n=e.toLowerCase().replace(" ","-"),t=document.createElement("div"),a=document.createElement("input");a.type="checkbox",a.id=n,a.name=n,a.value=e;var i=document.createElement("label");return i.htmlFor=n,i.className="padded",i.appendChild(document.createTextNode(e)),t.appendChild(a),t.appendChild(i),t});n.appendChild(i),n.appendChild(a),o.forEach(e=>{n.appendChild(e)});var r=document.createElement("button");r.appendChild(document.createTextNode("Absenden")),n.appendChild(r),firebase.database().ref("/polls/0").on("value",function(e){var n=e.val();r.onclick=function(){var e=0,t=o.map(function(n){return checkbox=n.querySelector("input[type=checkbox]"),checkbox.checked&&(e+=1),[checkbox,checkbox.checked]});if(2==e){var i=a.value;if(16!=i.length)alert("Dein Truhenschluessel muss exakt 16 Zeichen haben, aktuell hast du "+i.length+" Zeichen.");else{var r=!1,c=!0;if(n.keys.forEach(function(e){i===e.value&&(r=!0,n.items.forEach(function(e){"object"==typeof e.votes&&Object.keys(e.votes).forEach(function(n){e.votes[n]===i&&(c=!1)})}))}),r&&c){var l=[];t.forEach(function(e){!0===e[1]&&l.push(e[0].value)});var u={};l.forEach(function(e){var t=-1;n.items.some(function(n){if(t+=1,n.name===e)return!0});var a=firebase.database().ref().child("polls/0/items/"+t+"/votes").push().key;u["polls/0/items/"+t+"/votes/"+a]=i}),Object.keys(u).length>0?firebase.database().ref().update(u,function(e){e?alert("Deine Abstimmung war nicht erfolgreich, bitte versuche es spaeter nochmal !"):alert("Deine Abstimmung war erfolgreich !")}):alert("Es gab einen Fehler bei der Uebertragung deiner Abstimmung, bitte versuche es spaeter nochmal ! ")}else alert("Dein Truhenschluessel ist ungueltig oder wurde schon benutzt !")}}else alert("Du hast zwei Stimmen ! Du hast aber "+e+" checkboxen aktiviert.")}})}).catch(function(){n.innerHTML="Die Daten fuer die Abstimmung konnten nicht geladen werden, ist deine Internetverbindung ok ?",alert("Die Daten fuer die Abstimmung konnten nicht geladen werden, ist deine Internetverbindung ok ?")})};